# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è LLM –ø–∞–π–ø–ª–∞–π–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤

**–î–∞—Ç–∞**: 2 –Ω–æ—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è**: 1.0
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –≥–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 19 –Ω–æ—è–±—Ä—è 2025

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –Ω–∞ —Å–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å—Ç—Ä–µ—á. –û—Å–Ω–æ–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –≤–∫–ª—é—á–∞—é—Ç —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ LLM, –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ prompt caching –∏ —Å–æ–∑–¥–∞–Ω–∏–µ unified –ø–æ–¥—Ö–æ–¥–∞ —Å self-reflection.

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

**–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** (–≤—Å—Ç—Ä–µ—á–∞ 30 –º–∏–Ω, ~50K —Ç–æ–∫–µ–Ω–æ–≤ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏):
- 6 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ LLM
- ~320K –≤—Ö–æ–¥–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
- ~$3.20 —Å—Ç–æ–∏–º–æ—Å—Ç—å (GPT-4)
- ~15-25 —Å–µ–∫—É–Ω–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**:
- 4 –∑–∞–ø—Ä–æ—Å–∞ (—Å unified) –∏–ª–∏ 5 (—Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º two-stage)
- ~25-175K –≤—Ö–æ–¥–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
- ~$0.25-$1.75 —Å—Ç–æ–∏–º–æ—Å—Ç—å
- ~8-12 —Å–µ–∫—É–Ω–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–≠–∫–æ–Ω–æ–º–∏—è**: 45-78% —Ç–æ–∫–µ–Ω–æ–≤, 40-50% –≤—Ä–µ–º–µ–Ω–∏, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è —Å—Ä–µ–¥—Å—Ç–≤

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤—Å—Ç—Ä–µ—á–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: –¢–µ–º—ã, —Ä–µ—à–µ–Ω–∏—è –∏ –∑–∞–¥–∞—á–∏ –∏–∑–≤–ª–µ–∫–∞–ª–∏—Å—å –¥–≤–∞–∂–¥—ã:
- –í `meeting_structure_builder` (–∑–∞–ø—Ä–æ—Å—ã 1-3)
- –í –¥–≤—É—Ö—ç—Ç–∞–ø–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (Stage 1)

**–†–µ—à–µ–Ω–∏–µ**: `meeting_structure` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –≤—Å—Ç—Ä–µ—á–∏. –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è.

**–§–∞–π–ª—ã**:
- `src/services/optimized_processing_service.py` (—Å—Ç—Ä–æ–∫–∏ 1052-1054)

### 2. –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ Stage 2

**–ü—Ä–æ–±–ª–µ–º–∞**: Stage 2 –ø–æ–ª—É—á–∞–ª –ø–æ–ª–Ω—É—é —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é –ø–æ–≤—Ç–æ—Ä–Ω–æ (~50K —Ç–æ–∫–µ–Ω–æ–≤)

**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ `extract_relevant_excerpts()`, –∫–æ—Ç–æ—Ä–∞—è –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö Stage 1.

**–§–∞–π–ª—ã**:
- `src/utils/context_extraction.py` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
- `llm_providers.py` (—Ñ—É–Ω–∫—Ü–∏—è `_build_reflection_prompt`, —Å—Ç—Ä–æ–∫–∏ 1727-1770)

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `max_context_tokens_stage2` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10000 —Ç–æ–∫–µ–Ω–æ–≤ = ~2500 —Å–ª–æ–≤)

### 3. Unified Protocol Generation

**–ü—Ä–æ–±–ª–µ–º–∞**: –î–≤–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ (Stage 1 + Stage 2) —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å

**–†–µ—à–µ–Ω–∏–µ**: –ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ —Å –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º, –≥–¥–µ –º–æ–¥–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏ self-reflection –≤ –µ–¥–∏–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.

**–§–∞–π–ª—ã**:
- `llm_providers.py` (—Ñ—É–Ω–∫—Ü–∏–∏ `generate_protocol_unified` –∏ `_build_unified_prompt`, —Å—Ç—Ä–æ–∫–∏ 2206-2473)
- `src/models/llm_schemas.py` (–∫–ª–∞—Å—Å `UnifiedProtocolSchema`, —Å—Ç—Ä–æ–∫–∏ 62-74)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ –¥–≤—É—Ö
- –ú–æ–¥–µ–ª—å –¥–µ–ª–∞–µ—Ç self-reflection –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –°–Ω–∏–∂–µ–Ω–∏–µ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –Ω–∞ 40-50%
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ prompt caching

### 4. Prompt Caching –¥–ª—è OpenAI

**–ü—Ä–æ–±–ª–µ–º–∞**: –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –±–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ prompt caching —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏ –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª–∏–Ω–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤.

**–§–∞–π–ª—ã**:
- `src/utils/context_extraction.py` (—Ñ—É–Ω–∫—Ü–∏—è `add_prompt_caching_markers`)
- `llm_providers.py` (—Å—Ç—Ä–æ–∫–∏ 2404-2407)

**–≠–∫–æ–Ω–æ–º–∏—è**: 90% —Å–∫–∏–¥–∫–∞ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ (–∫—ç—à –∂–∏–≤–µ—Ç 5-10 –º–∏–Ω—É—Ç)

---

## –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

### src/utils/context_extraction.py

–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:

```python
def extract_relevant_excerpts(transcription, extracted_data, max_tokens=10000)
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏"""

def build_structure_summary(meeting_structure)
    """–°–æ–∑–¥–∞–µ—Ç –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤—Å—Ç—Ä–µ—á–∏"""

def add_prompt_caching_markers(system_prompt, transcription, task_specific_prompt)
    """–°–æ–∑–¥–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–æ–æ–±—â–µ–Ω–∏–π —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏ –¥–ª—è prompt caching"""
```

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ config.py

```python
# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è LLM –ø–∞–π–ø–ª–∞–π–Ω–∞
enable_unified_protocol_generation: bool = Field(
    False, 
    description="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å unified –ø–æ–¥—Ö–æ–¥ (1 –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ Stage 1+2) —Å self-reflection"
)

enable_prompt_caching: bool = Field(
    True, 
    description="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å prompt caching –¥–ª—è OpenAI (—ç–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤)"
)

max_context_tokens_stage2: int = Field(
    10000, 
    description="–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è Stage 2"
)
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –í–∫–ª—é—á–∏—Ç—å unified –ø–æ–¥—Ö–æ–¥
export ENABLE_UNIFIED_PROTOCOL_GENERATION=true

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è Stage 2
export MAX_CONTEXT_TOKENS_STAGE2=15000

# –û—Ç–∫–ª—é—á–∏—Ç—å prompt caching (–µ—Å–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)
export ENABLE_PROMPT_CACHING=false
```

---

## –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –º–µ—Ç–æ–¥–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

–û–±–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤ –≤ `optimized_processing_service.py`:

```python
if enable_unified_protocol_generation and llm_provider == 'openai':
    # Unified –ø–æ–¥—Ö–æ–¥ (1 –∑–∞–ø—Ä–æ—Å —Å self-reflection)
    # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è + –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
    
elif should_use_cot and llm_provider == 'openai':
    # Chain-of-Thought –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á (>30 –º–∏–Ω)
    # –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è + –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    
elif two_stage_processing and llm_provider == 'openai':
    # –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø–æ–¥—Ö–æ–¥
    # Stage 1: –ø–æ–ª–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ
    # Stage 2: —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã (—ç–∫–æ–Ω–æ–º–∏—è ~80% —Ç–æ–∫–µ–Ω–æ–≤)
    
else:
    # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
    # Fallback –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
```

---

## A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í–∫–ª—é—á–µ–Ω–∏–µ unified –ø–æ–¥—Ö–æ–¥–∞

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```bash
export ENABLE_UNIFIED_PROTOCOL_GENERATION=true
python main.py
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –í .env —Ñ–∞–π–ª–µ**
```
ENABLE_UNIFIED_PROTOCOL_GENERATION=true
```

**–í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ –≤ config.py** (–¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –≤–∫–ª—é—á–µ–Ω–∏—è)
```python
enable_unified_protocol_generation: bool = Field(True, ...)
```

### –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–û–±—Ä–∞–±–æ—Ç–∞—Ç—å 10-20 –≤—Å—Ç—Ä–µ—á** —Å unified –ø–æ–¥—Ö–æ–¥–æ–º
2. **–°—Ä–∞–≤–Ω–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ** —Å –ø–æ–º–æ—â—å—é `protocol_validator`:
   - `overall_score`
   - `completeness_score`
   - `structure_score`
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π/–æ—à–∏–±–æ–∫
4. **–ò–∑–º–µ—Ä–∏—Ç—å —ç–∫–æ–Ω–æ–º–∏—é** (–µ—Å–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç—Ä–∏–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤)

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–õ–æ–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:

```
# –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞
INFO: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ unified –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (1 –∑–∞–ø—Ä–æ—Å —Å self-reflection)
INFO: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–≤—É—Ö—ç—Ç–∞–ø–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π)

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
INFO: –ò—Å–ø–æ–ª—å–∑—É–µ–º meeting_structure (—Å–∂–∞—Ç–æ: 2543 —Å–∏–º–≤–æ–ª–æ–≤)
INFO: Stage 2: —Å–æ–∫—Ä–∞—â–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å 124567 –¥–æ 35234 —Å–∏–º–≤–æ–ª–æ–≤

# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
INFO: Unified generation –∑–∞–≤–µ—Ä—à–µ–Ω, confidence=0.87
INFO: –≠—Ç–∞–ø 2 –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ (—É–ª—É—á—à–µ–Ω–∏–µ: +3.2%)
```

### –û—Ç–∫–∞—Ç

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–∞—á–µ—Å—Ç–≤–æ–º:

```bash
export ENABLE_UNIFIED_PROTOCOL_GENERATION=false
```

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–µ—Ä–Ω–µ—Ç—Å—è –∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –¥–≤—É—Ö—ç—Ç–∞–ø–Ω–æ–º—É –ø–æ–¥—Ö–æ–¥—É.

---

## –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –°—Ö–µ–º–∞ UnifiedProtocolSchema

```python
class SelfReflectionSchema(BaseModel):
    """–°—Ö–µ–º–∞ –¥–ª—è self-reflection (—Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–∏)"""
    completeness: float                     # –ü–æ–ª–Ω–æ—Ç–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è (0.0-1.0)
    missing_info: List[str]                 # –ù–µ–¥–æ—Å—Ç–∞—é—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    ambiguous_points: List[str]             # –ù–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã
    quality_concerns: List[str]             # –ü—Ä–æ–±–ª–µ–º—ã –∫–∞—á–µ—Å—Ç–≤–∞

class UnifiedProtocolSchema(BaseModel):
    protocol_data: Dict[str, str]           # –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    self_reflection: SelfReflectionSchema   # –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–∏ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
    confidence_score: float                 # –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (0.0-1.0)
    quality_notes: str                      # –ó–∞–º–µ—Ç–∫–∏ –ø–æ –∫–∞—á–µ—Å—Ç–≤—É
    detected_speaker_mapping: Optional[...]  # –ú–∞–ø–ø–∏–Ω–≥ —Å–ø–∏–∫–µ—Ä–æ–≤
    speaker_confidence_scores: Optional[...] # –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –º–∞–ø–ø–∏–Ω–≥–µ
    unmapped_speakers: Optional[List[str]]  # –ù–µ—Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–ø–∏–∫–µ—Ä—ã
    mapping_notes: Optional[str]            # –ó–∞–º–µ—Ç–∫–∏ –ø–æ –º–∞–ø–ø–∏–Ω–≥—É
```

### –§—É–Ω–∫—Ü–∏—è extract_relevant_excerpts

–ê–ª–≥–æ—Ä–∏—Ç–º –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤:

1. –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–∑—ã –∏–∑ `extracted_data` (–ø–µ—Ä–≤—ã–µ 3-5 —Å–ª–æ–≤ –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è)
2. –ò—â–µ—Ç —ç—Ç–∏ —Ñ—Ä–∞–∑—ã –≤ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ —Å –ø–æ–º–æ—â—å—é regex
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –±–µ—Ä–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç ¬±200 —Å–∏–º–≤–æ–ª–æ–≤
4. –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è `max_tokens`
5. Fallback: –µ—Å–ª–∏ —Ñ—Ä–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã - –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏

### –§—É–Ω–∫—Ü–∏—è build_structure_summary

–°–æ–∑–¥–∞–µ—Ç –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ `meeting_structure`:

```
–¢–ï–ú–´ (5):
1. –û–±—Å—É–∂–¥–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ –Ω–∞ Q1
   –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –Ω–∞ 15%, –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç - –º–∞—Ä–∫–µ—Ç–∏–Ω–≥

–†–ï–®–ï–ù–ò–Ø (8):
1. –£—Ç–≤–µ—Ä–¥–∏—Ç—å –±—é–¥–∂–µ—Ç –≤ —Ä–∞–∑–º–µ—Ä–µ 500K
2. –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–µ–≤—å—é –≤ –∫–æ–Ω—Ü–µ –º–µ—Å—è—Ü–∞

–ó–ê–î–ê–ß–ò (12):
1. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è CEO (–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤)
2. –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –ø–ª–∞–Ω —Å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –æ—Ç–¥–µ–ª–æ–º (–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π: –ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞)
```

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –ú–∞–∫—Å–∏–º—É–º 10 —Ç–µ–º (—Å key_points)
- –ú–∞–∫—Å–∏–º—É–º 15 —Ä–µ—à–µ–Ω–∏–π
- –ú–∞–∫—Å–∏–º—É–º 15 –∑–∞–¥–∞—á

---

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã

- ‚úÖ **OpenAI** - –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
- ‚ö†Ô∏è **Anthropic** - Unified –∏ prompt caching –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback)
- ‚ö†Ô∏è **Yandex GPT** - Unified –∏ prompt caching –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback)

### –ú–æ–¥–µ–ª–∏

Unified –ø–æ–¥—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ OpenAI:
- GPT-4, GPT-4 Turbo, GPT-4o
- GPT-3.5 Turbo (–º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω–µ–µ —Ç–æ—á–Ω—ã–º –≤ self-reflection)
- Azure OpenAI (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É structured outputs)

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

–í—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ **–æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã**:
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤–∫–ª—é—á–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ feature flags
- Fallback –Ω–∞ —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

---

## –ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏

1. **–û–±–Ω–æ–≤–∏—Ç–µ config.py** - –Ω–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. **–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª** - `src/utils/context_extraction.py`
3. **–û–±–Ω–æ–≤–ª–µ–Ω—ã —Ñ–∞–π–ª—ã**:
   - `llm_providers.py` (–Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)
   - `src/models/llm_schemas.py` (–Ω–æ–≤–∞—è —Å—Ö–µ–º–∞)
   - `src/services/optimized_processing_service.py` (–Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã
python -c "from src.utils.context_extraction import extract_relevant_excerpts; print('OK')"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ö–µ–º—É
python -c "from src.models.llm_schemas import UNIFIED_PROTOCOL_SCHEMA; print('OK')"

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å)
python -m pytest tests/ -v
```

---

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **Unified –ø–æ–¥—Ö–æ–¥** –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è OpenAI
   - –î–ª—è –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø–æ–¥—Ö–æ–¥
   
2. **Prompt caching** —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 5-10 –º–∏–Ω—É—Ç
   - –î–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤—Å—Ç—Ä–µ—á –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   
3. **–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –Ω–µ–æ—á–µ–≤–∏–¥–Ω—ã–µ —Å–≤—è–∑–∏
   - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `max_context_tokens_stage2`
   - –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —É–≤–µ–ª–∏—á—å—Ç–µ –¥–æ 15000-20000 —Ç–æ–∫–µ–Ω–æ–≤
   
4. **Structure summary** –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –ø–æ –æ–±—ä–µ–º—É
   - 10 —Ç–µ–º, 15 —Ä–µ—à–µ–Ω–∏–π, 15 –∑–∞–¥–∞—á
   - –î–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö –≤—Å—Ç—Ä–µ—á –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤—Å—Ç—Ä–µ—á (<15 –º–∏–Ω)

```python
enable_unified_protocol_generation = True
max_context_tokens_stage2 = 5000  # –ú–µ–Ω—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
```

### –î–ª—è —Å—Ä–µ–¥–Ω–∏—Ö –≤—Å—Ç—Ä–µ—á (15-45 –º–∏–Ω)

```python
enable_unified_protocol_generation = True  # –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
max_context_tokens_stage2 = 10000  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

### –î–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á (>45 –º–∏–Ω)

```python
# Chain-of-Thought –≤–∫–ª—é—á–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
# Unified –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á
max_context_tokens_stage2 = 15000  # –ë–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è Stage 2
```

### –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ (–±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)

```python
enable_unified_protocol_generation = False
max_context_tokens_stage2 = 50000  # –ü–æ—á—Ç–∏ –ø–æ–ª–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è
```

---

## –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–π —ç–∫–æ–Ω–æ–º–∏–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ `processing_metrics`:

```python
# –í src/models/processing.py
class ProcessingMetrics:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
    total_input_tokens: int = 0
    total_output_tokens: int = 0
    prompt_cache_hits: int = 0
    optimization_method: str = ""  # unified/two-stage/chain-of-thought
    tokens_saved_percent: float = 0.0
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–∫–æ–Ω–æ–º–∏–∏

–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ `src/utils/token_cache_logger.py`:

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ LLM –≤—ã–∑–æ–≤–∞
if settings.log_cache_metrics:
    log_cached_tokens_usage(
        response=response,
        context="Two-Stage: Stage 1",
        model_name="gpt-4o",
        provider="openai"
    )
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ –≤ –ª–æ–≥–∞—Ö:**

```
[Two-Stage: Stage 1 Extraction] –¢–æ–∫–µ–Ω—ã: prompt=21854, completion=3701, total=25555
[Two-Stage: Stage 1 Extraction] üí∞ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–æ: 15000 —Ç–æ–∫–µ–Ω–æ–≤ (68.6% –æ—Ç prompt)
[Two-Stage: Stage 1 Extraction] üíµ –≠–∫–æ–Ω–æ–º–∏—è: $0.0375 (50.0%) | –°—Ç–æ–∏–º–æ—Å—Ç—å: $0.0375 –≤–º–µ—Å—Ç–æ $0.0750
```

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∏ –º–æ–¥–µ–ª–∏

| –ü—Ä–æ–≤–∞–π–¥–µ—Ä | –ú–æ–¥–µ–ª—å | –°–∫–∏–¥–∫–∞ | –ú–µ—Ç–æ–¥ | –ú–∏–Ω. —Ä–∞–∑–º–µ—Ä |
|-----------|--------|--------|-------|-------------|
| OpenAI | gpt-4o | 50% | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π | 1024 —Ç–æ–∫–µ–Ω–∞ |
| OpenAI | gpt-4o-mini | 50% | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π | 1024 —Ç–æ–∫–µ–Ω–∞ |
| OpenAI | gpt-4-turbo | 50% | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π | 1024 —Ç–æ–∫–µ–Ω–∞ |
| Anthropic | claude-3-5-sonnet | 90% | –Ø–≤–Ω—ã–π (cache_control) | 1024 —Ç–æ–∫–µ–Ω–∞ |
| Anthropic | claude-3-opus | 90% | –Ø–≤–Ω—ã–π (cache_control) | 1024 —Ç–æ–∫–µ–Ω–∞ |

### –ü—Ä–∏–º–µ—Ä —ç–∫–æ–Ω–æ–º–∏–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–í—Å—Ç—Ä–µ—á–∞ 30 –º–∏–Ω—É—Ç, —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è 20K —Ç–æ–∫–µ–Ω–æ–≤:**

```
Stage 1 (Extraction):
  Prompt: 21,854 —Ç–æ–∫–µ–Ω–æ–≤
  –ö–µ—à–∏—Ä–æ–≤–∞–Ω–æ: 15,000 —Ç–æ–∫–µ–Ω–æ–≤ (68.6%)
  –≠–∫–æ–Ω–æ–º–∏—è: $0.0375 (50%)

Stage 2 (Reflection):
  Prompt: 13,783 —Ç–æ–∫–µ–Ω–æ–≤  
  –ö–µ—à–∏—Ä–æ–≤–∞–Ω–æ: 10,000 —Ç–æ–∫–µ–Ω–æ–≤ (72.5%)
  –≠–∫–æ–Ω–æ–º–∏—è: $0.0250 (50%)

–ò—Ç–æ–≥–æ —ç–∫–æ–Ω–æ–º–∏—è: $0.0625 (~44% –æ—Ç –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

```bash
# –í–∫–ª—é—á–∏—Ç—å prompt caching (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é True)
ENABLE_PROMPT_CACHING=true

# –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
LOG_CACHE_METRICS=true

# –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è (~1024 —Ç–æ–∫–µ–Ω–æ–≤)
MIN_TRANSCRIPTION_LENGTH_FOR_CACHE=3000

# –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ (–æ—Ç–ª–∞–¥–∫–∞)
CACHE_METRICS_IN_FINAL_MESSAGE=false
```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**OpenAI (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ):**
```python
# –ü—Ä–µ—Ñ–∏–∫—Å—ã >= 1024 —Ç–æ–∫–µ–Ω–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–µ—à–∏—Ä—É—é—Ç—Å—è
messages = [
    {"role": "system", "content": system_prompt},  # –ö–µ—à–∏—Ä—É–µ—Ç—Å—è
    {"role": "user", "content": [
        {"type": "text", "text": f"–¢–†–ê–ù–°–ö–†–ò–ü–¶–ò–Ø:\n\n{transcription}"},  # –ö–µ—à–∏—Ä—É–µ—Ç—Å—è
        {"type": "text", "text": task_prompt}  # –ù–µ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è (–∏–∑–º–µ–Ω—è–µ—Ç—Å—è)
    ]}
]
```

**Anthropic (—è–≤–Ω–æ–µ):**
```python
# –¢—Ä–µ–±—É–µ—Ç —è–≤–Ω—ã—Ö cache_control –º–∞—Ä–∫–µ—Ä–æ–≤
system = [
    {"type": "text", "text": system_prompt},
    {
        "type": "text",
        "text": f"–¢–†–ê–ù–°–ö–†–ò–ü–¶–ò–Ø:\n\n{transcription}",
        "cache_control": {"type": "ephemeral"}  # –Ø–≤–Ω–∞—è –º–µ—Ç–∫–∞
    }
]
```

### Best Practices

1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–º–ø—Ç–æ–≤**: –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç (system + —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è) –≤–Ω–∞—á–∞–ª–µ, –∏–∑–º–µ–Ω—è—é—â–∏–π—Å—è –≤ –∫–æ–Ω—Ü–µ
2. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–µ—Ñ–∏–∫—Å >= 1024 —Ç–æ–∫–µ–Ω–æ–≤ (~3000 —Å–∏–º–≤–æ–ª–æ–≤)
3. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤**: Stage 1 –∏ Stage 2 —Å –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–µ–π –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –ø–æ–¥—Ä—è–¥ (–∫–µ—à –∂–∏–≤–µ—Ç 5-10 –º–∏–Ω—É—Ç)
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ cache hit rate –≤ –ª–æ–≥–∞—Ö

**–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. [PROMPT_CACHING_GUIDE.md](./PROMPT_CACHING_GUIDE.md)**

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ —Å unified –ø–æ–¥—Ö–æ–¥–æ–º

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `confidence_score` –≤ –ª–æ–≥–∞—Ö (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å >0.7)
2. –£–≤–µ–ª–∏—á—å—Ç–µ `max_context_tokens_stage2` –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback –Ω–∞ two-stage
3. –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ unified –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ context_extraction

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ls -la src/utils/context_extraction.py

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ __init__.py
touch src/utils/__init__.py
```

### –ü—Ä–æ–±–ª–µ–º–∞: Prompt caching –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é OpenAI: `pip show openai`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –º–æ–¥–µ–ª—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç caching (GPT-4, GPT-4o)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ `cached_tokens` –≤ usage

### –ü—Ä–æ–±–ª–µ–º–∞: meeting_structure –≤—Å–µ–≥–¥–∞ –ø—É—Å—Ç–∞—è

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `enable_meeting_structure=True` –≤ config
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ OpenAI –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è structure extraction

---

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 –Ω–µ–¥–µ–ª–∏)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 100+ –≤—Å—Ç—Ä–µ—á–∞—Ö
- [ ] –ë–µ–Ω—á–º–∞—Ä–∫ –∫–∞—á–µ—Å—Ç–≤–∞ unified vs two-stage

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (1 –º–µ—Å—è—Ü)
- [ ] –£–º–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—ã–±–æ—Ä–∞ –º–µ—Ç–æ–¥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –≤—Å—Ç—Ä–µ—á–∏
- [ ] –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π `max_context_tokens_stage2` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ unified –¥–ª—è Anthropic Claude

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (3+ –º–µ—Å—è—Ü–∞)
- [ ] –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤—Å—Ç—Ä–µ—á–∏
- [ ] –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–æ –≥—Ä—É–ø–ø–∞–º –ø–æ–ª–µ–π
- [ ] ML-–º–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞

---

## –°—Å—ã–ª–∫–∏

- [OpenAI Structured Outputs](https://platform.openai.com/docs/guides/structured-outputs)
- [OpenAI Prompt Caching](https://platform.openai.com/docs/guides/prompt-caching)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ meeting_structure](./MEETING_STRUCTURE.md)
- [–î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è](./STRUCTURED_OUTPUTS_IMPLEMENTATION.md)

---

## –ê–≤—Ç–æ—Ä—ã

- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: AI Assistant (Claude Sonnet 4.5)
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: *—Ç—Ä–µ–±—É–µ—Ç—Å—è*
- –†–µ–≤—å—é –∫–æ–¥–∞: *—Ç—Ä–µ–±—É–µ—Ç—Å—è*

## Changelog

### [1.0.0] - 2025-11-02

**Added**
- Unified protocol generation —Å self-reflection
- Prompt caching –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è OpenAI
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ Stage 2 (extract_relevant_excerpts)
- –ö–æ–º–ø–∞–∫—Ç–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ meeting_structure (build_structure_summary)
- –ù–æ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (context_extraction.py)

**Changed**
- –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –º–µ—Ç–æ–¥–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (unified –∫–∞–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- _build_reflection_prompt —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
- meeting_structure –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**Fixed**
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–º/—Ä–µ—à–µ–Ω–∏–π/–∑–∞–¥–∞—á
- –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –ø–æ–ª–Ω–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –≤ Stage 2

**Performance**
- –≠–∫–æ–Ω–æ–º–∏—è 45-78% –≤—Ö–æ–¥–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
- –°–Ω–∏–∂–µ–Ω–∏–µ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –Ω–∞ 40-50%
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

