# Руководство по облачной транскрипции

## Обзор

В боте теперь поддерживается облачная транскрипция через Groq API как альтернатива локальной обработке через Whisper. Это позволяет:

- Более быструю транскрипцию (без необходимости загружать модели)
- Снижение нагрузки на сервер
- Использование современных моделей Whisper в облаке

## Конфигурация

### Переменные окружения

Добавьте в ваш `.env` файл:

```env
# Режим транскрипции: local (локально) или cloud (облако)
TRANSCRIPTION_MODE=cloud

# API ключ Groq
GROQ_API_KEY=your_groq_api_key_here

# Модель для транскрипции (опционально)
GROQ_MODEL=whisper-large-v3-turbo
```

### Получение API ключа Groq

1. Зарегистрируйтесь на [Groq Console](https://console.groq.com/)
2. Создайте новый API ключ
3. Добавьте ключ в переменную окружения `GROQ_API_KEY`

## Установка зависимостей

Установите необходимые зависимости:

```bash
pip install groq>=0.4.0
```

Или обновите зависимости из requirements.txt:

```bash
pip install -r requirements.txt
```

## Режимы работы

### Локальная транскрипция

```env
TRANSCRIPTION_MODE=local
```

- Использует локальные модели Whisper
- Требует больше ресурсов сервера
- Работает без интернета
- Поддерживает диаризацию (разделение говорящих)

### Облачная транскрипция

```env
TRANSCRIPTION_MODE=cloud
GROQ_API_KEY=your_api_key
```

- Использует облачные модели Groq
- Быстрее и менее ресурсоемко
- Требует интернет-соединение
- Без диаризации (только текст транскрипции)

### Гибридная транскрипция (рекомендуемый режим)

```env
TRANSCRIPTION_MODE=hybrid
GROQ_API_KEY=your_api_key
ENABLE_DIARIZATION=true
```

- **Облачная транскрипция** через Groq (быстро)
- **Локальная диаризация** для разделения говорящих
- Лучшее из двух миров: скорость + качество
- Требует интернет-соединение

## Поддерживаемые модели Groq

- `whisper-large-v3-turbo` (по умолчанию, быстрая)
- `whisper-large-v3` (более точная, медленнее)

## Fallback механизм

Если облачная транскрипция недоступна (нет API ключа, ошибка API), система автоматически переключится на локальную транскрипцию.

## Гибридный подход

Для получения лучшего из двух миров (скорость + качество) используйте гибридный режим:

```env
TRANSCRIPTION_MODE=hybrid
ENABLE_DIARIZATION=true
```

Этот режим:
1. Выполняет **быструю облачную транскрипцию** через Groq
2. Применяет **локальную диаризацию** для разделения говорящих
3. Объединяет результаты для максимального качества

Подробнее см. [HYBRID_APPROACH_DIAGRAM.md](HYBRID_APPROACH_DIAGRAM.md)

## Обработка ошибок

Система обрабатывает различные типы ошибок:

- **CloudTranscriptionError**: Общие ошибки облачной транскрипции
- **GroqAPIError**: Специфичные ошибки Groq API (превышение лимитов, проблемы авторизации)
- **TranscriptionError**: Общие ошибки транскрипции

## Мониторинг и логирование

Все операции транскрипции логируются:

```log
INFO: Groq клиент инициализирован
INFO: Выполнение облачной транскрипции через Groq...
INFO: Облачная транскрипция завершена. Длина текста: 1234 символов
```

## Пример использования

```python
from src.services.transcription_service import TranscriptionService
from config import settings

# Создание сервиса
service = TranscriptionService()

# Транскрипция файла
result = await service.transcribe_with_diarization(
    file_path="audio.mp3",
    language="ru"
)

print(f"Транскрипция: {result.transcription}")
```

## Рекомендации

1. **Для продакшена**: Используйте облачную транскрипцию для улучшения производительности
2. **Для разработки**: Можете использовать локальную транскрипцию
3. **Гибридный подход**: Настройте fallback на локальную транскрипцию при проблемах с API

## Ограничения

- Максимальный размер файла для Groq API: 25 MB
- Поддерживаемые форматы: mp3, mp4, mpeg, mpga, m4a, wav, webm
- Ограничения по количеству запросов согласно тарифному плану Groq
