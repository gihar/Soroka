# Руководство для Apple Silicon (M1/M2/M3)

## Настройки диаризации для Apple Silicon

Если вы используете Mac с процессором Apple Silicon (M1, M2, M3), рекомендуется следующая конфигурация:

### Базовая настройка (рекомендуется)

```bash
# В файле .env
ENABLE_DIARIZATION=false
```

Диаризация по умолчанию отключена для обеспечения стабильности работы бота.

### Если хотите включить диаризацию

```bash
# В файле .env
ENABLE_DIARIZATION=true
DIARIZATION_DEVICE=cpu
COMPUTE_TYPE=int8
HUGGINGFACE_TOKEN=your_token_here
```

### Объяснение настроек

- `ENABLE_DIARIZATION=false` - Отключает диаризацию, бот будет работать только с транскрипцией
- `DIARIZATION_DEVICE=cpu` - Принудительно использует CPU вместо MPS для совместимости
- `COMPUTE_TYPE=int8` - Использует оптимизированный тип данных для CPU
- `HUGGINGFACE_TOKEN` - Токен для доступа к моделям диаризации (требуется для pyannote.audio)

### Получение токена Hugging Face

1. Зарегистрируйтесь на https://huggingface.co/
2. Перейдите в настройки: https://huggingface.co/settings/tokens
3. Создайте новый токен с правами на чтение
4. Добавьте токен в переменную окружения `HUGGINGFACE_TOKEN`

### Известные проблемы

- MPS устройство может вызывать ошибки в WhisperX
- Диаризация требует значительно больше ресурсов, чем простая транскрипция
- Первая загрузка моделей может занять несколько минут
- В WhisperX 3.4.2+ встроенный DiarizationPipeline удален, теперь используется pyannote.audio

### Изменения в WhisperX 3.4.2+

Начиная с версии 3.4.2, WhisperX больше не включает встроенную диаризацию. Теперь:
- WhisperX выполняет только транскрипцию и выравнивание
- Диаризация выполняется отдельно через pyannote.audio
- Результаты объединяются для создания финальной транскрипции с говорящими

### Альтернатива

Если диаризация не критична, рекомендуется использовать бота без неё:
- Быстрее работает
- Меньше потребляет ресурсов  
- Более стабильная работа
- Не требует токена Hugging Face

Бот по-прежнему будет создавать качественные протоколы на основе транскрипции.
