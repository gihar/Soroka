# Исправление ошибки Event Loop в системе прогресса

## Проблема

После внедрения системы отслеживания прогресса транскрипции возникла ошибка:

```
Ошибка транскрипции: no running event loop
RuntimeWarning: coroutine 'ProgressTracker.update_stage_progress' was never awaited
```

### Причина

Проблема заключалась в том, что асинхронные колбэки прогресса вызывались из синхронного контекста (thread pool), где нет активного event loop.

Ранее использовался колбэк с передачей процентов и текста подэтапа; этот подход признан устаревшим и удалён.

## Решение

Реализован thread-safe механизм обновления прогресса с graceful fallback.

### Текущее состояние

Механизм колбэков прогресса удалён. Обновления прогресса больше не передаются из рабочих потоков; интерфейс показывает итоговые статусы этапов без перцентилей.

### Как это работает

1. **Основной поток (с event loop)**: Обновления прогресса передаются через `asyncio.run_coroutine_threadsafe()`
2. **Рабочий поток (без event loop)**: Используется fallback логирование
3. **Ошибки**: Graceful обработка исключений без прерывания транскрипции

## Технические детали

### `asyncio.run_coroutine_threadsafe()`

Эта функция позволяет запускать корутины из других потоков:

```python
future = asyncio.run_coroutine_threadsafe(
    async_function(),
    target_event_loop
)
```

### Обработка исключений

- **`RuntimeError`**: Нет активного event loop → используем логирование
- **Другие исключения**: Логируем предупреждение, но не прерываем процесс

### Fallback механизм

Ранее использовалось логирование прогресса для fallback. Теперь логируются только ключевые события (старт/успех/ошибка) без процентов.

## Результат

### ДО (с ошибками)
```
❌ Ошибка транскрипции: no running event loop
❌ RuntimeWarning: coroutine was never awaited
❌ Процесс прерывается
```

### ПОСЛЕ (исправлено)
```
✅ Обновления прогресса в основном потоке работают
✅ Graceful fallback в рабочих потоках
✅ Транскрипция завершается успешно
✅ Нет ошибок event loop
```

## Протестировано

- ✅ Thread-safe колбэки прогресса
- ✅ Работа в основном потоке с event loop
- ✅ Работа в рабочих потоках без event loop
- ✅ Обработка отсутствия event loop
- ✅ Graceful fallback при ошибках

## Измененные файлы

- Удалены вызовы колбэков прогресса в сервисах обработки

## Обратная совместимость

- ⚠️ API прогресса удалён: колбэки и проценты больше не используются.
- ✅ Логика обработки не зависит от прогресса

## Мониторинг

В логах теперь можно увидеть:
- `DEBUG`: Progress update: X% (когда используется fallback)
- `WARNING`: Ошибка при обновлении прогресса (при неожиданных исключениях)

Эти сообщения информационные и не означают ошибки в работе системы.
