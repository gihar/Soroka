# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ "–£–º–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞"

## –î–∞—Ç–∞: 2025-10-20

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å "ü§ñ –£–º–Ω—ã–π –≤—ã–±–æ—Ä" –∫–∞–∫ —à–∞–±–ª–æ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:

```
**–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —à–∞–±–ª–æ–Ω–∞**

–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —à–∞–±–ª–æ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
–í–æ–∑–º–æ–∂–Ω–æ, —à–∞–±–ª–æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.
```

## –ü—Ä–∏—á–∏–Ω–∞
–§—É–Ω–∫—Ü–∏—è `set_user_default_template` –≤ `database.py` –ø—Ä–æ–≤–µ—Ä—è–ª–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ `templates`:

```python
cursor = await db.execute("""
    SELECT id FROM templates 
    WHERE id = ? AND (created_by = ? OR is_default = 1)
""", (template_id, user_id))

if not await cursor.fetchone():
    return False  # –®–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω - –æ—à–∏–±–∫–∞!
```

–ö–æ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è `template_id = 0` (—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è "–£–º–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞"), –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∞, —Ç–∞–∫ –∫–∞–∫ —à–∞–±–ª–æ–Ω–∞ —Å `id = 0` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

## –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ `template_id = 0`, –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∞.

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–π —Ñ–∞–π–ª: `database.py`

**–°—Ç—Ä–æ–∫–∏ 459-468:**

```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —à–∞–±–ª–æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
# template_id = 0 - —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è "–£–º–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞", –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
if template_id != 0:
    cursor = await db.execute("""
        SELECT id FROM templates 
        WHERE id = ? AND (created_by = ? OR is_default = 1)
    """, (template_id, user_id))
    
    if not await cursor.fetchone():
        return False
```

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ó–Ω–∞—á–µ–Ω–∏—è template_id:
- `template_id = 0` ‚Üí "–£–º–Ω—ã–π –≤—ã–±–æ—Ä" (ML-—Å–µ–ª–µ–∫—Ç–æ—Ä)
- `template_id > 0` ‚Üí –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —à–∞–±–ª–æ–Ω –∏–∑ –ë–î
- `template_id = NULL` ‚Üí –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

### –¢–µ–ø–µ—Ä—å:
1. –ï—Å–ª–∏ `template_id = 0` ‚Üí —Å—Ä–∞–∑—É —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏)
2. –ï—Å–ª–∏ `template_id > 0` ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
3. –í –æ–±–æ–∏—Ö —Å–ª—É—á–∞—è—Ö –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–æ–ª–µ `default_template_id`

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É:
1. ‚úÖ –ó–∞–π—Ç–∏ –≤ `/settings` ‚Üí "–®–∞–±–ª–æ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"
2. ‚úÖ –ù–∞–∂–∞—Ç—å "ü§ñ –£–º–Ω—ã–π –≤—ã–±–æ—Ä (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)"
3. ‚úÖ –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–±–µ–∑ –æ—à–∏–±–∫–∏)
4. ‚úÖ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —É–º–Ω—ã–π –≤—ã–±–æ—Ä
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É –æ–±—ã—á–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ ‚Üí –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–±—Ä–æ—Å ‚Üí –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

## –°—Ç–∞—Ç—É—Å
‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ** - 2025-10-20

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã
- `database.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `if template_id != 0:`

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

