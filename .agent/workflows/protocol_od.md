---
description: Генерация Протокола Поручений (OD Protocol)
---

# Workflow: Генерация Протокола Поручений (OD Protocol)

Этот воркфлоу описывает процесс создания "Протокола поручений" (OD Protocol) из аудиозаписи встречи. Режим предназначен для автоматического извлечения задач, сроков и ответственных лиц из разговора.

## 1. Предварительные требования (Prerequisites)

Для корректной работы режима OD необходимо:

1.  **Аудиофайл**: Запись встречи, где четко слышны голоса участников.
2.  **Список участников**: Необходимо знать имена и **роли** участников.
    *   Критически важно: Среди участников должен быть хотя бы один "Руководитель" (роль должна содержать слова: "Руководитель", "Директор", "Начальник", "Manager", "Head" и т.д.).
    *   Система использует роли для определения направления поручений (от руководителя к подчиненным).

## 2. Инициализация (Trigger)

Процесс запускается при создании `ProcessingRequest` со следующими параметрами:

*   `processing_mode`: **`"od_protokol"`** (Обязательно)
*   `participants_list`: Список словарей `{"name": "Имя", "role": "Роль"}`.
*   `llm_provider`: Рекомендуется `"openai"` (для поддержки Structured Outputs).

## 3. Этапы обработки (Process)

### Шаг 3.1: Транскрибация и Диаризация
Система преобразует аудио в текст и разделяет реплики по спикерам (Speaker 1, Speaker 2...).

### Шаг 3.2: Сопоставление спикеров
Система сопоставляет голоса (Speaker X) с реальными именами из `participants_list`.

### Шаг 3.3: Анализ и Извлечение (LLM)
LLM анализирует диалог с использованием специализированного системного промпта (`_build_od_system_prompt`).
Модель ищет паттерны постановки задач:
*   **Кто поставил**: Руководитель.
*   **Кому**: Ответственный.
*   **Что**: Формулировка задачи.
*   **Срок**: Дата/время выполнения.

Данные извлекаются в строгом формате `ODProtocolSchema`.

### Шаг 3.4: Форматирование
Извлеченные данные преобразуются в текстовый отчет с помощью функции `format_od_protocol`.

## 4. Результат (Output)

На выходе формируется текстовый документ следующего вида:

```text
ПРОТОКОЛ ПОРУЧЕНИЙ
============================================================
Дата встречи: DD.MM.YYYY
Руководители: [Имя Руководителя]

1. [Название темы/задачи]
   [Текст поручения]
   Отв. [Фамилия И.О.] Срок — [Дата]

2. ...
```

## Пример использования (Code)

```python
request = ProcessingRequest(
    file_name="meeting.mp3",
    processing_mode="od_protokol",
    participants_list=[
        {"name": "Иван Иванов", "role": "Директор"},
        {"name": "Петр Петров", "role": "Менеджер"}
    ],
    meeting_date="20.11.2025"
)
```
