# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Structured Outputs —Å JSON Schema

## –û–±–∑–æ—Ä

–£—Å–ø–µ—à–Ω–æ –≤–Ω–µ–¥—Ä–µ–Ω—ã [OpenAI Structured Outputs](https://platform.openai.com/docs/guides/structured-outputs) –¥–ª—è –≤—Å–µ—Ö –≤—ã–∑–æ–≤–æ–≤ LLM API –≤ –ø—Ä–æ–µ–∫—Ç–µ. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ –≤–∞–ª–∏–¥–Ω–æ–≥–æ JSON –∏ —É–ª—É—á—à–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–æ–≤.

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/models/llm_schemas.py`

–°–æ–¥–µ—Ä–∂–∏—Ç Pydantic –º–æ–¥–µ–ª–∏ –∏ –∏—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ JSON Schema –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤:

- `ProtocolSchema` - –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –≤—Å—Ç—Ä–µ—á–∏
- `TwoStageExtractionSchema` - –¥–ª—è –¥–≤—É—Ö—ç—Ç–∞–ø–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (Stage 1)
- `TwoStageReflectionSchema` - –¥–ª—è —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ (Stage 2)
- `SegmentSchema` - –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
- `SynthesisSchema` - –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞ –≤ chain-of-thought
- `SpeakerMappingSchema` - –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–ø–∏–∫–µ—Ä–æ–≤
- `TopicsExtractionSchema` - –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–º
- `DecisionsExtractionSchema` - –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ä–µ—à–µ–Ω–∏–π
- `ActionItemsExtractionSchema` - –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∑–∞–¥–∞—á

### 2. –û–±–Ω–æ–≤–ª–µ–Ω `llm_providers.py`

–ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ 5 –≤—ã–∑–æ–≤–æ–≤ `client.chat.completions.create`:

- `OpenAIProvider.generate_protocol()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `PROTOCOL_SCHEMA`
- `generate_protocol_two_stage()` Stage 1 - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `TWO_STAGE_EXTRACTION_SCHEMA`
- `generate_protocol_two_stage()` Stage 2 - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `TWO_STAGE_REFLECTION_SCHEMA`
- `_process_single_segment()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `SEGMENT_SCHEMA`
- `generate_protocol_chain_of_thought()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `SYNTHESIS_SCHEMA`

### 3. –û–±–Ω–æ–≤–ª–µ–Ω `src/services/speaker_mapping_service.py`

- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `SPEAKER_MAPPING_SCHEMA`
- –û–±–Ω–æ–≤–ª–µ–Ω –≤—ã–∑–æ–≤ LLM –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è structured output

### 4. –û–±–Ω–æ–≤–ª–µ–Ω `src/services/meeting_structure_builder.py`

- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `get_schema_by_type`
- –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `_call_llm_for_extraction()` –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å—Ö–µ–º—ã –ø–æ —Ç–∏–ø—É –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—Ö–µ–º—ã: `topics`, `decisions`, `action_items`

## –§–æ—Ä–º–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

–í—Å–µ –≤—ã–∑–æ–≤—ã –∏–∑–º–µ–Ω–µ–Ω—ã —Å:
```python
response_format={"type": "json_object"}
```

–ù–∞:
```python
response_format={"type": "json_schema", "json_schema": SCHEMA_NAME}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å JSON** - OpenAI API —Ç–µ–ø–µ—Ä—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç –≤–∞–ª–∏–¥–Ω–æ–≥–æ JSON
2. **–°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** - JSON Schema –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö
3. **–õ—É—á—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
4. **–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –ë–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å–∏—Å—Ç–µ–º—ã

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- ‚úÖ –í—Å–µ —Å—Ö–µ–º—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `get_schema_by_type()` —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤
- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ JSON Schema —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç—É OpenAI

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã. –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ —Ç–µ–ø–µ—Ä—å —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é.

## –°—Ç–∞—Ç—É—Å

üü¢ **–ó–ê–í–ï–†–®–ï–ù–û** - –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–µ–¥—Ä–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ.
